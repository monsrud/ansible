---
- hosts: ubuntu
  remote_user: root
  become: true
  become_user: root

  tasks:

  - name: Update 
    apt:
      name: "*" 
      update_cache: yes
      state: latest

  - name: Install open vm tools if this is a virtual machine
    when: ansible_virtualization_role == "guest"
    apt:
      name: open-vm-tools
      state: latest

  - name: Disable the firewall
    ufw:
      state: disabled

  - name: Disable IPv6 with sysctl
    sysctl: name={{ item }} value=1 state=present reload=yes
    with_items:
      - net.ipv6.conf.all.disable_ipv6
      - net.ipv6.conf.default.disable_ipv6
      - net.ipv6.conf.lo.disable_ipv6

  - name: Disable IPv6 autoconf with sysctl
    sysctl: name={{ item }} value=0 state=present reload=yes
    with_items:
      - net.ipv6.conf.all.autoconf 
      - net.ipv6.conf.default.autoconf 
      - net.ipv6.conf.lo.autoconf
