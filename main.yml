---
#
# Common settings for Centos/Ubuntu test lab hosts
#
- hosts: '*'
  remote_user: root
  become: true
  become_user: root

  tasks:

  - name: Disable IPv6 with sysctl
    sysctl: name={{ item }} value=1 state=present reload=yes
    with_items:
      - net.ipv6.conf.all.disable_ipv6
      - net.ipv6.conf.default.disable_ipv6
      - net.ipv6.conf.lo.disable_ipv6
    when: ansible_facts['os_family'] == 'Debian' or ansible_facts['os_family'] == 'RedHat'

  - name: Disable IPv6 autoconf with sysctl
    sysctl: name={{ item }} value=0 state=present reload=yes
    with_items:
      - net.ipv6.conf.all.autoconf
      - net.ipv6.conf.default.autoconf
      - net.ipv6.conf.lo.autoconf
    when: ansible_facts['os_family'] == 'Debian' or ansible_facts['os_family'] == 'RedHat'

  - name: Check for selinux config
    stat: 
      path: /etc/selinux/config
    register: config_file 

  - name: Disable selinux
    selinux:
      state: disabled
    when: config_file.stat.exists

  - name: Add the user 'lab' 
    ansible.builtin.user:
      name: lab
      password: $6$iA5foPioS79MFT9G$AsO6rSyOkEzlh.daS1wQiO8EKojkq8/KFSGh17GBDZ0JMLxcKUmps8g5X9PkSkXkzHhPelc4q4qVgE3y0HBgX/
      shell: /bin/bash
      #      groups: wheel, admin, sudo
      #      append: yes
      # maybe put lab into specific groups based on os type
      # on centos, put them in wheel
      # on ubuntu put them in admin or sudo

  - name: Include CentOS Packages/Tasks
    include_tasks: centos_tasks.yml
    when: ansible_facts['os_family'] == 'RedHat'

  - name: Include Ubuntu Packages/Tasks
    include_tasks: ubuntu_tasks.yml
    when: ansible_facts['os_family'] == 'Debian'





